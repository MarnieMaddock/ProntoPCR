<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Graphs –  ProntoPCR Handbook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title"><img src="images/dottori_lab_pentagon.svg" height="32" style="vertical-align: middle; margin-right: 0.5em;"> ProntoPCR Handbook</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./overview.html"> 
<span class="menu-text">Overview</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-getting-started" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Getting Started</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-getting-started">    
        <li>
    <a class="dropdown-item" href="./local_access.html">
 <span class="dropdown-text">Local Access (Recommended)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./online_access.html">
 <span class="dropdown-text">Online Access</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-how-to-use" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">How to Use</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-how-to-use">    
        <li>
    <a class="dropdown-item" href="./data_input.html">
 <span class="dropdown-text">Input Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./calculations.html">
 <span class="dropdown-text">Calculations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./statistics.html">
 <span class="dropdown-text">Statistics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./graphs.html">
 <span class="dropdown-text">Graphs</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-error-messages" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Error Messages</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-error-messages">    
        <li>
    <a class="dropdown-item" href="./input_errors.html">
 <span class="dropdown-text">Input Data Errors</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./stat_graph_errors.html">
 <span class="dropdown-text">Stats &amp; Graph Errors</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./version_history.html"> 
<span class="menu-text">Version History</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./features_issues.html"> 
<span class="menu-text">Feature Requests</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./references.html"> 
<span class="menu-text">References</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#customising-labels" id="toc-customising-labels" class="nav-link active" data-scroll-target="#customising-labels">Customising Labels</a></li>
  <li><a href="#graph-design" id="toc-graph-design" class="nav-link" data-scroll-target="#graph-design">Graph Design</a></li>
  <li><a href="#significance" id="toc-significance" class="nav-link" data-scroll-target="#significance">Significance</a></li>
  <li><a href="#error-bars" id="toc-error-bars" class="nav-link" data-scroll-target="#error-bars">Error Bars</a></li>
  <li><a href="#point-design" id="toc-point-design" class="nav-link" data-scroll-target="#point-design">Point Design</a></li>
  <li><a href="#downloading-graphs" id="toc-downloading-graphs" class="nav-link" data-scroll-target="#downloading-graphs">Downloading Graphs</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Graphs</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Graphs can be generated within the Graphs Tab. They are automatically generated after selecting the Samples and gene to graph. Each graph is fully customisable. Currently, there are three types of graphs available: scatter plot, grouped scatter plot and column graph:</p>
<p><img src="images/picture38.png" class="img-fluid" width="700"></p>
<p>To get started, select whether to graph (2^-ΔCq) or (2^-ΔΔCq) data in the side panel, and select the samples and gene:</p>
<p><img src="images/picture40.png" class="img-fluid" width="400"></p>
<p>To generate the graph, type the sample names in the order to be displayed on the x-axis. The samples must be separated by a comma with no spaces. It is case-sensitive:</p>
<p><img src="images/picture39.png" class="img-fluid" width="400"></p>
<section id="customising-labels" class="level2">
<h2 class="anchored" data-anchor-id="customising-labels">Customising Labels</h2>
<p>Labels for the x and y axes can be changed in the side panel. To remove a label, enter a space in the text input box. The x-axis labels can be rotated by selecting the checkbox:</p>
<p><img src="images/picture41.png" class="img-fluid" width="700"></p>
<p>The x and y-axis titles accept markup.</p>
<p>The x and y-axis titles accept markup:</p>
<ul>
<li><code>*italics*</code></li>
<li><code>**bold**</code></li>
<li><code>***bold and italics***</code></li>
<li><code>&lt;br&gt; &lt;/br&gt; Line Break</code></li>
<li><code>&lt;sup&gt; superscript &lt;/sup&gt;</code></li>
<li><code>&lt;sub&gt; subscript &lt;/sub&gt;</code></li>
</ul>
<p>The font can be changed in the dropdown menu. If your desired font is not listed, download the graph as a scalable vector graphics file (svg) and edit it in Inkscape, PowerPoint or Illustrator. Alternatively, suggest new fonts on <a href="https://github.com/MarnieMaddock/ProntoPCR/issues">GitHub Issues</a>. Text size can be changed by pressing the up or down arrow, or by typing in the required size in the respective box on the side panel</p>
<p><img src="images/picture42.png" class="img-fluid" width="700"></p>
<p>If Grouped Scatter Plot is selected, the legend can be customised or removed:</p>
<p><img src="images/picture43.png" class="img-fluid" width="700"></p>
</section>
<section id="graph-design" class="level2">
<h2 class="anchored" data-anchor-id="graph-design">Graph Design</h2>
<p>To change the colours of the graph, select from the drop-down menu. An error message will be displayed if there are too many groups for the selected palette. Colour palettes available:</p>
<p><img src="images/color_schemes.png" class="img-fluid" width="700"> <img src="images/picture44.png" class="img-fluid" width="700"></p>
<p>To change the graph type, select the preferred option in the Choose Plot Type menu:</p>
<p><img src="images/picture45.png" class="img-fluid" width="700"></p>
</section>
<section id="significance" class="level2">
<h2 class="anchored" data-anchor-id="significance">Significance</h2>
<p>A group comparison test must be performed in the Statistics Tab to add significance options to a graph. The results from the post-hoc test will be used on the graph. The chosen calculation (i.e.&nbsp;2-(ΔCq) or 2-(ΔΔCq)), samples and gene must be identical in the Statistics and Graphs tab for the correct p-values to be plotted. Error messages (Discrepancy detected) will appear if the options do not match, and will prompt the user to alter the selection. If the graph is empty, it may mean that a discrepancy was detected and needs to be changed for the graph to generate. For example, to add significance to a graph for the samples: F_sample1, M_sample1, F_sample2, M_sample2 and gene ISL1 with a log2 transformation:</p>
<p><img src="images/picture46.png" class="img-fluid" width="700"></p>
<p>Three ways to denote significance on a graph are available, including asterisk notation (<code>*, **, ***, ns</code>), p-values (<code>0.001</code>), or compact letter display (<code>a, b, c, ac</code>).</p>
<ol type="a">
<li>Asterisk Option: The label size (size of *), bracket thickness (line thickness), step increase (the vertical distance between each bracket) and tip length (vertical bracket length) can all be altered by changing the up and down arrows, or by entering in a number value. Non-significant comparisons can be hidden by pressing the Hide ns checkbox.</li>
</ol>
<p><img src="images/picture47.png" class="img-fluid" width="700"></p>
<ol start="2" type="a">
<li>P Values Option: The label size (size of 0.002), bracket thickness (line thickness), step increase (the vertical distance between each bracket), tip length (vertical bracket length) and p-value decimal places can all be altered by changing the up and down arrows, or by entering in a number value. Non-significant comparisons can be hidden by pressing the Hide ns checkbox. The leading 0 from the p-value can also be removed by pressing the corresponding checkbox. P = can also be added before the p-value by selecting this option in the P-value prefix selection.</li>
</ol>
<p><img src="images/picture48.png" class="img-fluid" width="700"></p>
<ol start="3" type="a">
<li>Compact Letter Display: Letters denoting differences between groups come from the output given in the Statistics tab. The Label Size and Step Increase can be changed by using the up and down errors within the box, or entering a number.</li>
</ol>
<p><img src="images/picture49.png" class="img-fluid" width="700"></p>
</section>
<section id="error-bars" class="level2">
<h2 class="anchored" data-anchor-id="error-bars">Error Bars</h2>
<p>Three types of error bars can be selected in the Choose Error Bar section, including: Standard error, standard deviation and 95% Confidence Interval.</p>
<p><img src="images/picture50.png" class="img-fluid" width="700"></p>
<p>Often, error bars are missing if the Start Y-axis at 0 checkbox is selected. Uncheck this box to display error bars correctly:</p>
<p><img src="images/picture51.png" class="img-fluid" width="700"></p>
<p>Error bar and average bar width and thickness can be changed using the up and down arrows within the box, or by entering a number:</p>
<p><img src="images/picture52.png" class="img-fluid" width="700"></p>
<p>Error bar and average line colours can be matched to the dot points by selecting the corresponding checkboxes:</p>
<p><img src="images/picture53.png" class="img-fluid" width="700"></p>
</section>
<section id="point-design" class="level2">
<h2 class="anchored" data-anchor-id="point-design">Point Design</h2>
<p>For scatter plots and grouped scatter plots:</p>
<ol type="a">
<li>Data points on the graph can be customised by size, thickness and point spread by changing the number on the corresponding boxes. Shapes can be changed using the dropdown box:</li>
</ol>
<p><img src="images/picture54.png" class="img-fluid" width="700"></p>
<p>If data points are overlapping the seed number can be changed. This is a random and arbitrary number. The same seed number will keep the points in the same position each time the graph generates:</p>
<p><img src="images/picture55.png" class="img-fluid" width="700"></p>
<p>For column graphs:</p>
<ol start="2" type="a">
<li>The column graph can be customised by colour fill or border by toggling the Choose fill or Border dropdown menu:</li>
</ol>
<p><img src="images/picture56.png" class="img-fluid" width="700"></p>
<p>Point size and spread can be altered by changing the number of the corresponding box:</p>
<p><img src="images/picture57.png" class="img-fluid" width="700"></p>
</section>
<section id="downloading-graphs" class="level2">
<h2 class="anchored" data-anchor-id="downloading-graphs">Downloading Graphs</h2>
<p>Graphs can be downloaded by clicking the Download Graph button. Graphs can be saved as an SVG, tiff, png, or jpeg by toggling the dropdown menu. It is recommended to download as an SVG, as these files can be opened in Inkscape, PowerPoint or Illustrator to further customise graph aesthetics. Remember to ungroup the graph to edit the individual components.</p>
<p>The width and height of the graph can be changed, as well as the dots per inch (DPI) by altering the numbers in the corresponding boxes. Note that by changing the DPI it alters the graph dimensions, and so may change the aesthetics of the graph. After downloading a graph check it meets your requirements.</p>
<p><img src="images/picture58.png" class="img-fluid" width="700"></p>
<p>To save the options selected to create the graph, press the download selected graph options button. This is useful as a reference to keep graph aesthetics similar across samples/genes etc. It is downloaded as a HTML file which can be opened in most web browsers.</p>
<p><img src="images/picture59.png" class="img-fluid" width="400"></p>
<p><a href="./input_errors.html" class="btn btn-md" style="background:#00359bff;border-color:#00359bff;color:#fff;">Error Messages »</a></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/marniemaddock\.github\.io\/ProntoPCR\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>